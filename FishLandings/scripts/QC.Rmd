---
title: "Quality Control of Fishing Landings dataset"
author: "Author: Emma Strand; emma_strand@uri.edu"
output:
  github_document: default
  pdf_document:
    keep_tex: yes
  html_document:
    toc: yes
    toc_depth: 6
    toc_float: yes
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Contents 

- [**Protocol to run this with a future xlsx file**](#protocol)   
- [**Load all libraries**](#libraries)  
- [**Create dataframe**](#df)  
- [**Quality Control: enumerator**](#Enumerator)  
- [**Quality Control: landing_site and BMU**](#Landing_site)  
- [**Quality Control: fisher information**](#fisher_info)  
- [**Quality Control: trap information**](#trap)  
- [**Quality Control: catch information**](#catch)  
- [**Gear type, and fish numbers/final destination**](#gear)  
- [**Quality Control: final check for notes written by field team**](#notes)   
- [**Exporting cleaned dataset**](#export)  

## <a name="protocol"></a> **Protocol to run this with a future xlsx file**

1. In the toolbar above, hit the arrow next to `Knit`. Scroll down to `Knit Directory` and select the option `Project Directory`.    
2. **In `Create dataframe` code chunk**: Replace raw data file name in the function that creates the following variables: fishing_operation, catch_composition, and validation_lists.    
3. **In `Enumerator`, `Landing_site`, and `BMU` code chunks**: Run the unique() function and double check that this list is the correct names.  
4. **In Trap information**, run code chunk functions for `trap_type` and `total_traps_collected` sections and double check the output is as expected.  
5. **In catch information**, run code chunk functions for `weight and value measures`, `number of fishers in crew`, and `Kiswahili_name` and double check the output is as expected.  
6. **In Species/Scientific name**, run code chunk functions and check output to make sure it is as expected.  
7. **In length, gear type, number of fish, and desintation sections**, run code chunk to double check the output of ranges is as expected.  
8. In the export section, rename the new datafile excel file.  

## <a name="libraries"></a> **Load all libraries**

```{r, message=FALSE, warning=FALSE}
library(plyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(readxl)
library(lubridate)
library(Hmisc)
library(writexl)
library(naniar)
```

## <a name="df"></a> **Create dataframe**

**Load in raw data files.** 

Using this df `Fishlandings-data- CC-JM-Clay-IW updated 04-09-2022`: The date is formatted DD-MM-YYYY. This file is from September. 

[Reading in an excel datafile instead of a csv](http://www.sthda.com/english/wiki/reading-data-from-excel-files-xls-xlsx-into-r). This requires the `readxl` package listed in load all libraries step. 

```{r, message=FALSE, warning=FALSE}
## when running future iterations of raw data file, replace the file name below 
fishing_operation <- read_excel("data/Fishlandings-data- CC-JM-Clay-IW updated 04-09-2022.xlsx", sheet = "fishing_operation",
                                col_types = c("date", "text", "text", "text", "text", "text", "text", 
                                              "text", "numeric", "date", "text", "date", "text", "numeric", 
                                              "numeric", "numeric", "numeric", "numeric", "numeric","text", "skip")) %>%
  rename(Operation_date = date_dd_mm_yyyy)

nrow(fishing_operation) 
# 10,670 July updated file; fishing operations (keep this # in mind for sanity check at the end)
# 8,463 September updated file

## when running future iterations of raw data file, replace the file name below 
catch_composition <- read_excel("data/Fishlandings-data- CC-JM-Clay-IW updated 04-09-2022.xlsx", 
                                sheet = "catch_composition",
                                col_types = c("date", "text", "text", "text", "text", "text", "numeric",
                                              "text", "text", "skip")) %>%
  rename(Operation_date = Date)

nrow(catch_composition) 
# 58,441 July updated file; fish observations (keep this # in mind for sanity check at the end)
# 65,357 September updated file

## when running future iterations of raw data file, replace the file name below 
validation_lists <- read_excel("data/Fishlandings-data- CC-JM-Clay-IW updated 04-09-2022.xlsx", sheet = "validation_lists")

# read in enumerator names file 
enumerator_list <- read_excel("data/enumerator_list.xlsx")
```

Errors found in fisher_id column are mostly capitalization errors. 

```{r}
fishing_operation$fisher_id <- toupper(fishing_operation$fisher_id)
catch_composition$fisher_id <- toupper(catch_composition$fisher_id)
```

Creating a larger dataframe to work with for the rest of quality control. 
```{r}
df <- full_join(fishing_operation, catch_composition, by = c("fisher_id", "Operation_date")) %>%
  select(-`time_in_water (effort)`) %>% # take this out if we start collecting time in water data
  rename(fishing_operation_notes= general_notes) %>%
  rename(catch_composition_notes = notes_picture) %>%
  rename(scientific_name = SPECIES) %>%
  rename(total_biomass_kg = total_weight_kg) 
```

## Quality Control 

### Operation_date 

In the above chunk, these dates are automatically read in as *dttm* format (date and time). 

### <a name="Enumerator"></a> **Enumerator**

[Replace character string with another in R](https://stackoverflow.com/questions/11936339/replace-specific-characters-within-strings)

A lot of errors occur with different lower and upper case iterations of names. I replaced this information with all upper case to collapse this information. For example, "kadzo baya" and "Kadzo baya" are the same fisherman but were reading as different categories. 

Kadzo Baya and Kadzo Kazungu refer to the same person. 

```{r}
# change all lower case to upper case
df$enumerator <- toupper(df$enumerator)
enumerator_list$enumerator <- toupper(enumerator_list$enumerator)

# replace incorrect spellings 
df$enumerator <- gsub("CELESTINAR.N.ALI", "CELESTINE N. ALI", df$enumerator)
df$enumerator <- gsub("^CELESTINAR$", "CELESTINE N. ALI", df$enumerator)
df$enumerator <- gsub("CELESTINAR NALI", "CELESTINE N. ALI", df$enumerator)
df$enumerator <- gsub("CELESTINER NALI", "CELESTINE N. ALI", df$enumerator)
df$enumerator <- gsub("^CLAPERTON$", "CLAPERTON KAZUNGU", df$enumerator)
df$enumerator <- gsub("MACKSON KAZUNGU", "MAXSON KAZUNGU", df$enumerator)
df$enumerator <- gsub("BIDALA RASHID", "BIDALLA RASHID", df$enumerator)
df$enumerator <- gsub("GARAMA YERI", "GARAMA K. YERI", df$enumerator)
df$enumerator <- gsub("GARAMA K YERI", "GARAMA K. YERI", df$enumerator)
df$enumerator <- gsub("BRUNO MUYE", "BRUNO MOYE", df$enumerator)
df$enumerator <- gsub("^ALI$", "CELESTINE N. ALI", df$enumerator) #^ and $ indicate start and end of phrase
df$enumerator <- gsub("KADZO KAZUNGU", "KADZO BAYA", df$enumerator)
df$enumerator <- gsub("KADZU BAYA", "KADZO BAYA", df$enumerator)
df$enumerator <- gsub("ANTONY JUMA", "ANTHONY JUMA", df$enumerator)
df$enumerator <- gsub("CLAPETRON", "CLAPERTON KAZUNGU", df$enumerator)
df$enumerator <- gsub("KARIM NYINGE", "KARIMA NYINGE", df$enumerator)
df$enumerator <- gsub("KARIMA NYINGEE", "KARIMA NYINGE", df$enumerator)
df$enumerator <- gsub("^BRUNO$", "BRUNO MOYE", df$enumerator)
df$enumerator <- gsub("MARKSON KAZUNGU", "MAXSON KAZUNGU", df$enumerator)
df$enumerator <- gsub("BIDAKA RASHID", "BIDALLA RASHID", df$enumerator)

# compare df list to the enumerator list 
# result is those that appear in the df but not validated enumerator list
setdiff(df$enumerator, enumerator_list$enumerator)

## Step #2 in protocol at the top of this script 
unique(sort(df$enumerator)) # at this point, double check that this list are all individual fishermen 
```

### <a name="Landing_site"></a> **Landing_site and BMU**

### Landing site

```{r}
df$landing_site <- toupper(df$landing_site)
enumerator_list$landing_site <- toupper(enumerator_list$landing_site)

df$landing_site <- gsub("KIRKLAND", "KARKLAND", df$landing_site)
df$landing_site <- gsub("KITANGONI", "KITANGANI", df$landing_site)
df$landing_site <- gsub("KIUKONI", "KIVUKONI", df$landing_site)
df$landing_site <- gsub("KIVUKANI", "KIVUKONI", df$landing_site)
df$landing_site <- gsub("KIVUKUNI", "KIVUKONI", df$landing_site)

# compare df list to the enumerator list 
# result is those that appear in the df but not validated enumerator list
setdiff(df$landing_site, enumerator_list$landing_site)
unique(sort(df$landing_site))

## Step #3 in protocol to double check this output list is all the correct site names 
## (if the only output from setdiff() is NA then this list is correct)
```

### BMU 

```{r}
df$BMU <- toupper(df$BMU)
enumerator_list$BMU <- toupper(enumerator_list$BMU)

# compare df list to the enumerator list 
# result is those that appear in the df but not validated enumerator list
setdiff(df$BMU, enumerator_list$BMU)

unique(sort(df$BMU))
## Step #4 in protocol to double check this output list is all the correct BMU names 
## (if the only output from setdiff() is NA then this list is correct)
```

### <a name="Fisher_info"></a> **Fisher information**

We don't have a current need to correct fisher phone number right now. 

### household_id

The only issue I can detect here is some lower case vs upper case. 

It would be nice to have a list of expected household and fisher ID's. 

Some IDs only have 2 digits at the end - are these missing an zero in front of them? I.e. 90 vs 090?

```{r}
df$household_id <- toupper(df$household_id)
unique(df$household_id)

df$household_id <- gsub("/FF", "", df$household_id)
```

### <a name="trap"></a> **Trap information**

### trap_type 

The only issue I can detect here is some lower case vs upper case. 

```{r}
df$trap_type <- toupper(df$trap_type)
unique(sort(df$trap_type))
```

### total_traps_collected 

View the values put in the df here to double check all values make sense. 

```{r}
total_traps_collected <- df %>% select(total_traps_collected) %>% na.omit()
range(total_traps_collected)

## filtering traps to below 40
df$total_traps_collected <- ifelse(df$total_traps_collected > 40, NA, df$total_traps_collected)

## Protocol with new df: double check the below range is expected 
hist(df$total_traps_collected)
```

### Date and time set; date and time collected

In the first chunk of code, these dates are automatically read in as *dttm* format (date and time). This new columns will be more useful for data analysis later. 

```{r, warning=FALSE}
# making new columns for date and time 
df$date_time_set <- paste(df$date_set_dd_mm_yyyy, df$`time_set_24hh:mm`, sep = " ")
df$date_time_collected <- paste(df$date_collected_dd_mm_yyyy, df$`time_collected_24hh:mm`, sep = " ")

# removing the 'hrs' from observations in this column
df$date_time_set <- gsub("hrs", "", df$date_time_set)
df$date_time_collected <- gsub("hrs", "", df$date_time_collected)

# converting to date and time format 
df$date_time_set <- parse_date_time(df$date_time_set, orders = "ymdHM")
df$date_time_collected <- parse_date_time(df$date_time_collected, orders = "ymdHM")

## any failed to parse error messages will be from rows that do not have a date and time
```

### <a name="catch"></a> **Catch information**

### Biomass and value measures 

Step #4 from protocol: Double check the below values are in the correct ranges

```{r}
##### TOTAL BIOMASS 
total_biomass_kg <- df %>% select(total_biomass_kg) %>% na.omit()
range(total_biomass_kg)
# filtering biomass kg to under 100 kg 
df$total_biomass_kg <- ifelse(df$total_biomass_kg > 100, NA, df$total_biomass_kg)
hist(df$total_biomass_kg)

##### TAKE HOME BIOMASS 
# filtering take home weight to be under 10kg 
take_home_weight_kg <- df %>% select(take_home_weight_kg) %>% na.omit()
df$take_home_weight_kg <- ifelse(df$take_home_weight_kg > 10, NA, df$take_home_weight_kg)

range(take_home_weight_kg)
hist(df$take_home_weight_kg)
unique(sort(df$take_home_weight_kg))

##### TOTAL VALUE 
total_value_KES <- df %>% select(total_value_KES) %>% na.omit()
range(total_value_KES)
# filtering to below 5,000 
df$total_value_KES <- ifelse(df$total_value_KES > 5000, NA, df$total_value_KES)
hist(df$total_value_KES)

##### TAKE HOME VALUE 
take_home_value_KES <- df %>% select(take_home_value_KES) %>% na.omit()
df$take_home_value_KES <- ifelse(df$take_home_value_KES > 5000, NA, df$take_home_value_KES)

range(take_home_value_KES)
boxplot(df$take_home_value_KES)
unique(sort(df$take_home_value_KES))
```

### No. of fishers in crew

Crews above 7 people are unrealistic. I'm changing that data to 'NA' for now. 

```{r}
fishermen_no <- df %>% select(`No. of fishers in crew`) %>% na.omit()

hist(fishermen_no)

## Protocol: Double check the below values are in the correct ranges
range(fishermen_no)
unique(sort(fishermen_no$`No. of fishers in crew`))

df %>% filter(`No. of fishers in crew` > 7)

# df <- df %>%
#  mutate(crew_size = case_when(
#     `No. of fishers in crew` > 7 ~ "NA"))

df$crew_size_corrected <- df$`No. of fishers in crew`

# replacing values higher than 5 with NA
df <- df %>%
 replace_with_na_at(
    .vars = 'crew_size_corrected',
    condition = ~(.x > 7))

# double checking that the above worked
unique(sort(df$crew_size_corrected))
```

### Kiswahili_name

```{r}
df$Kiswahili_name <- toupper(df$Kiswahili_name)
unique(sort(df$Kiswahili_name))
```

### SPECIES / Scientific name 

**This is a hard-coding way to do this.. ideally we could downloand a dataset from fishbase and create a compare function that could recognize a name that is a letter or 2 off from a name in fishbase and then create suggestions...** 

We can pull in the validation_lists df to double check these spellings. 

```{r}
# Taking out double spaces in between genus and species 
validation_lists$scientific_name <- gsub("  ", " ", validation_lists$scientific_name)
```

Sorting through df for errors. 

```{r}
# create capitalize function for upper case genus and lower case species 
capitalize_fxn <- function(x){
  first <- toupper(substr(x, start=1, stop=1)) ## capitalize first letter
  rest <- tolower(substr(x, start=2, stop=nchar(x)))   ## everything else lowercase
  paste0(first, rest)
}

df$scientific_name <- capitalize_fxn(df$scientific_name)
validation_lists$scientific_name <- capitalize_fxn(validation_lists$scientific_name)

# Taking out double spaces in between genus and species 
df$scientific_name <- gsub("  ", " ", df$scientific_name)

# Correcting commonly misspelled genus names 

# this chunk is for one genus. This is a data input issue that is difficult to catch and fix in R
df$scientific_name <- gsub("Acanthrus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Acantharus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Acantrus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Acantarus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Acathurus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Acronthurus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Acanthrurus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("dossumieri", "dussumieri", df$scientific_name)
df$scientific_name <- gsub("dusimieri", "dussumieri", df$scientific_name)
df$scientific_name <- gsub("dusimii", "dussumieri", df$scientific_name)
df$scientific_name <- gsub("dussimieri", "dussumieri", df$scientific_name)
df$scientific_name <- gsub("Abdefduf", "Abudefduf", df$scientific_name)
df$scientific_name <- gsub("Cheilo", "Cheilio", df$scientific_name)
df$scientific_name <- gsub("inemis", "inermis", df$scientific_name)
df$scientific_name <- gsub("argentmaculatus", "argentimaculatus", df$scientific_name)
df$scientific_name <- gsub("Cheillinus", "Cheilinus", df$scientific_name)
df$scientific_name <- gsub("candiculatus", "canaliculatus", df$scientific_name)
df$scientific_name <- gsub("canaliculutus", "canaliculatus", df$scientific_name)
df$scientific_name <- gsub("Cholurururs", "Chlorurus", df$scientific_name)
df$scientific_name <- gsub("stronycephalus", "strongylocephalus", df$scientific_name)
df$scientific_name <- gsub("Gymonthorax", "Gymnothorax", df$scientific_name)
df$scientific_name <- gsub("Gymothorax", "Gymnothorax", df$scientific_name)
df$scientific_name <- gsub("javanicus", "favagineus", df$scientific_name)
df$scientific_name <- gsub("vaiginsis", "vaigiensis", df$scientific_name)
df$scientific_name <- gsub("semicirculatus", "semicirculatus", df$scientific_name)
df$scientific_name <- gsub("semisulcatus", "semicirculatus", df$scientific_name)
df$scientific_name <- gsub("Pomacnathus", "Pomacanthus", df$scientific_name)
df$scientific_name <- gsub("granoculis", "grandoculis", df$scientific_name)
df$scientific_name <- gsub("malanostigma", "melanostigma", df$scientific_name)
df$scientific_name <- gsub("hard", "harid", df$scientific_name)
df$scientific_name <- gsub("sexfaciatus", "sexfasciatus", df$scientific_name)
df$scientific_name <- gsub("dussumiera", "dussumieri", df$scientific_name)
df$scientific_name <- gsub("caeruleopanctatus", "caeruleopunctatus", df$scientific_name)
df$scientific_name <- gsub("hebei", "heberi", df$scientific_name)
df$scientific_name <- gsub("kippos", "hippos", df$scientific_name)
df$scientific_name <- gsub("Carnx", "Caranx", df$scientific_name)
df$scientific_name <- gsub("coioidea", "coioides", df$scientific_name)
df$scientific_name <- gsub("monochrou", "monochrous", df$scientific_name)
df$scientific_name <- gsub("monochrouss", "monochrous", df$scientific_name)
df$scientific_name <- gsub("Kyphasus", "Kyphosus", df$scientific_name)
df$scientific_name <- gsub("Lenthrinus", "Lethrinus", df$scientific_name)
df$scientific_name <- gsub("Leturinus", "Lethrinus", df$scientific_name)
df$scientific_name <- gsub("vaiguensis", "vaigiensis", df$scientific_name)
df$scientific_name <- gsub("bornonicus", "borbonicus", df$scientific_name)
df$scientific_name <- gsub("nebulosis", "nebulosus", df$scientific_name)
df$scientific_name <- gsub("nebulous", "nebulosus", df$scientific_name)
df$scientific_name <- gsub("Leptoscaus", "Leptoscarus", df$scientific_name)
df$scientific_name <- gsub("fluluiflamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("flavlineathe", "flavolineatus", df$scientific_name)
df$scientific_name <- gsub("taeniourous", "taeniorus", df$scientific_name)
df$scientific_name <- gsub("Navaculichthys", "Novaculichthys", df$scientific_name)
df$scientific_name <- gsub("taeniorus", "taeniourus", df$scientific_name)
df$scientific_name <- gsub("Parupeneus sp nov.", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Platux", "Platax", df$scientific_name)
df$scientific_name <- gsub("platyyuna", "platyura", df$scientific_name)
df$scientific_name <- gsub("playfair", "playfairi", df$scientific_name)
df$scientific_name <- gsub("Plectorhincus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectorhnichus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plotasus", "Plotosus", df$scientific_name)
df$scientific_name <- gsub("Pomatonus", "Pomatomus", df$scientific_name)
df$scientific_name <- gsub("Rhinecanthurus", "Rhineacanthus", df$scientific_name)
df$scientific_name <- gsub("vubroviolaceus", "rubroviolaceus", df$scientific_name)
df$scientific_name <- gsub("sirubroviolaceus", "rubroviolaceus", df$scientific_name)
df$scientific_name <- gsub("Scromberomorus", "Scomerommorus", df$scientific_name)
df$scientific_name <- gsub("Sphraena", "Sphyraena", df$scientific_name)
df$scientific_name <- gsub("meyeri", "meyeni", df$scientific_name)
df$scientific_name <- gsub("triostregus", "triostegus", df$scientific_name)
df$scientific_name <- gsub("Adudefduf", "Abudefduf", df$scientific_name)
df$scientific_name <- gsub("scoplas", "scopas", df$scientific_name)
df$scientific_name <- gsub("xanthonta", "xanthonota", df$scientific_name)
df$scientific_name <- gsub("Carangoifes", "Carangoides", df$scientific_name)
df$scientific_name <- gsub("vippos", "hippos", df$scientific_name)
df$scientific_name <- gsub("Cephelopholu", "Cephalopholis", df$scientific_name)
df$scientific_name <- gsub("Chaetadon", "Chaetodon", df$scientific_name)
df$scientific_name <- gsub("auringa", "auriga", df$scientific_name)
df$scientific_name <- gsub("selen$", "selene", df$scientific_name) # $ indicates end of phrase; didnt use ^ because this is species name is the 2nd word 
df$scientific_name <- gsub("trilohatus", "trilobatus", df$scientific_name)
df$scientific_name <- gsub("Cheiellinus", "Cheilinus", df$scientific_name)
df$scientific_name <- gsub("Cheillnus", "Cheilinus", df$scientific_name)
df$scientific_name <- gsub("inerms", "inermis", df$scientific_name)
df$scientific_name <- gsub("piinnulatus", "pinnulatus", df$scientific_name)
df$scientific_name <- gsub("pinnulatrus", "pinnulatus", df$scientific_name)
df$scientific_name <- gsub("Cirrihitus", "Cirrhitus", df$scientific_name)
df$scientific_name <- gsub("farmosa", "formosa", df$scientific_name)
df$scientific_name <- gsub("Cymonthorax", "Gymnothorax", df$scientific_name)
df$scientific_name <- gsub("Cynoglassus", "Cynoglossus", df$scientific_name)
df$scientific_name <- gsub("lachnen", "lachneri", df$scientific_name)
df$scientific_name <- gsub("luchneri", "lachneri", df$scientific_name)
df$scientific_name <- gsub("Epimephelus", "Epinephelus", df$scientific_name)
df$scientific_name <- gsub("colodes", "coioides", df$scientific_name)
df$scientific_name <- gsub("coicoides", "coioides", df$scientific_name)
df$scientific_name <- gsub("coloides", "coioides", df$scientific_name)
df$scientific_name <- gsub("faragineus", "favagineus", df$scientific_name)
df$scientific_name <- gsub("favagineous", "favagineus", df$scientific_name)
df$scientific_name <- gsub("hortulatus", "hortulanus", df$scientific_name)
df$scientific_name <- gsub("Himantur", "Himantura", df$scientific_name)
df$scientific_name <- gsub("Himanturaa", "Himantura", df$scientific_name)
df$scientific_name <- gsub("Hippscarus", "Hipposcarus", df$scientific_name)
df$scientific_name <- gsub("vagiensis", "vaigiensis", df$scientific_name)
df$scientific_name <- gsub("vaigienesis", "vaigiensis", df$scientific_name)
df$scientific_name <- gsub("fuaviflamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("fluliuflamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("fuluvifiamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("fulvifiamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("Latjanus", "Lutjanus", df$scientific_name)
df$scientific_name <- gsub("conchiliatus", "conchliatus", df$scientific_name)
df$scientific_name <- gsub("conchuliatutus", "conchliatus", df$scientific_name)
df$scientific_name <- gsub("conchyliantus", "conchliatus", df$scientific_name)
df$scientific_name <- gsub("hara$", "harak", df$scientific_name)
df$scientific_name <- gsub("harar$", "harak", df$scientific_name)
df$scientific_name <- gsub("letjan$", "lentjan", df$scientific_name)
df$scientific_name <- gsub("olivacous$", "olivaceus", df$scientific_name)
df$scientific_name <- gsub("Letjanus", "Lutjanus", df$scientific_name)
df$scientific_name <- gsub("Liza", "Planiliza", df$scientific_name)
df$scientific_name <- gsub("alatar$", "alata", df$scientific_name)
df$scientific_name <- gsub("argemtimaculutus", "argentimaculatus", df$scientific_name)
df$scientific_name <- gsub("argentinmaculatus", "argentimaculatus", df$scientific_name)
df$scientific_name <- gsub("ghibbon$", "gibbus", df$scientific_name)
df$scientific_name <- gsub("Lutjan", "Lutjanus", df$scientific_name)
df$scientific_name <- gsub("Lutjanusus", "Lutjanus", df$scientific_name)
df$scientific_name <- gsub("Migul", "Mugil", df$scientific_name)
df$scientific_name <- gsub("Monodactytus", "Monodactylus", df$scientific_name)
df$scientific_name <- gsub("bernditi", "berndti", df$scientific_name)
df$scientific_name <- gsub("berndt", "berndti", df$scientific_name)
df$scientific_name <- gsub("berndtii", "berndti", df$scientific_name)
df$scientific_name <- gsub("annalutus", "annulatus", df$scientific_name)
df$scientific_name <- gsub("anna$", "annulatus", df$scientific_name)
df$scientific_name <- gsub("annaturus", "annulatus", df$scientific_name)
df$scientific_name <- gsub("annulator", "annulatus", df$scientific_name)
df$scientific_name <- gsub("annulutus", "annulatus", df$scientific_name)
df$scientific_name <- gsub("annunthurus$", "annulatus", df$scientific_name)
df$scientific_name <- gsub("annuthurus$", "annulatus", df$scientific_name)
df$scientific_name <- gsub("brachycentus$", "brachycentron", df$scientific_name)
df$scientific_name <- gsub("bracycentron", "brachycentron", df$scientific_name)
df$scientific_name <- gsub("branchycentron", "brachycentron", df$scientific_name)
df$scientific_name <- gsub("unicaris", "unicornis", df$scientific_name)
df$scientific_name <- gsub("oyanea$", "cyanea", df$scientific_name)
df$scientific_name <- gsub("Panacirus", "Panulirus", df$scientific_name)
df$scientific_name <- gsub("Panilirus", "Panulirus", df$scientific_name)
df$scientific_name <- gsub("Panulinus", "Panulirus", df$scientific_name)
df$scientific_name <- gsub("homaruis", "homarus", df$scientific_name)
df$scientific_name <- gsub("humarus", "homarus", df$scientific_name)
df$scientific_name <- gsub("hurmarus", "homarus", df$scientific_name)
df$scientific_name <- gsub("pencillatus", "penicillatus", df$scientific_name)
df$scientific_name <- gsub("Paraparenus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapeneneus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapenenus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapeneous", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapeneus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapenious", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapenous", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Paraperenus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parupenenus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parupeneous", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parupenenus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Perepeneus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("baberinus", "barberinus", df$scientific_name)
df$scientific_name <- gsub("indica$", "indicus", df$scientific_name)
df$scientific_name <- gsub("Plactorhinches", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plactorhinchus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Platasus", "Plotosus", df$scientific_name)
df$scientific_name <- gsub("Platxbelone", "Platybelone", df$scientific_name)
df$scientific_name <- gsub("fiavomaculatus", "flavomaculatus", df$scientific_name)
df$scientific_name <- gsub("flavamaculatus", "flavomaculatus", df$scientific_name)
df$scientific_name <- gsub("plaxfairi", "playfairi", df$scientific_name)
df$scientific_name <- gsub("playfairii", "playfairi", df$scientific_name)
df$scientific_name <- gsub("sardidus", "sordidus", df$scientific_name)
df$scientific_name <- gsub("Plectorhinechus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectorhines", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectorhninus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectorihinchus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectrorchinchw", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectrorhinchw", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Priacanthurus", "Priacanthus", df$scientific_name)
df$scientific_name <- gsub("Pricanthurus", "Priacanthus", df$scientific_name)
df$scientific_name <- gsub("hamsur$", "hamrur", df$scientific_name)
df$scientific_name <- gsub("Psedorhombus", "Pseudorhombus", df$scientific_name)
df$scientific_name <- gsub("mile$", "miles", df$scientific_name)
df$scientific_name <- gsub("Rhineacanthus", "Rhinecanthus", df$scientific_name)
df$scientific_name <- gsub("aculateus$", "aculeatus", df$scientific_name)
df$scientific_name <- gsub("Sardinelle", "Sardinella", df$scientific_name)
df$scientific_name <- gsub("Scarrus", "Scarus", df$scientific_name)
df$scientific_name <- gsub("Scarua", "Scarus", df$scientific_name)
df$scientific_name <- gsub("Scarus$", "Scarus sp.", df$scientific_name)
df$scientific_name <- gsub("ghoban$", "ghobban", df$scientific_name)
df$scientific_name <- gsub("ghobbao", "ghobban", df$scientific_name)
df$scientific_name <- gsub("nuselii", "russelii", df$scientific_name)
df$scientific_name <- gsub("risselii", "russelii", df$scientific_name)
df$scientific_name <- gsub("ruselii", "russelii", df$scientific_name)
df$scientific_name <- gsub("psittatus", "psittacus", df$scientific_name)
df$scientific_name <- gsub("phargonis", "pharaonis", df$scientific_name)
df$scientific_name <- gsub("fluscence", "fuscescens", df$scientific_name)
df$scientific_name <- gsub("fluscenscens", "fuscescens", df$scientific_name)
df$scientific_name <- gsub("fluscescens", "fuscescens", df$scientific_name)
df$scientific_name <- gsub("gittatus", "guttatus", df$scientific_name)
df$scientific_name <- gsub("guitatus", "guttatus", df$scientific_name)
df$scientific_name <- gsub("Signus", "Siganus", df$scientific_name)
df$scientific_name <- gsub("Sphyreana", "Sphyraena", df$scientific_name)
df$scientific_name <- gsub("Spinephelus", "Epinephelus", df$scientific_name)
df$scientific_name <- gsub("iciura$", "leiura", df$scientific_name)
df$scientific_name <- gsub("satheta$", "sathete", df$scientific_name)
df$scientific_name <- gsub("Strougylura", "Strongylura", df$scientific_name)
df$scientific_name <- gsub("Suffiamen", "Sufflamen", df$scientific_name)
df$scientific_name <- gsub("Sufiamen", "Sufflamen", df$scientific_name)
df$scientific_name <- gsub("bymma", "lymma", df$scientific_name)
df$scientific_name <- gsub("chiltanae", "chiltonae", df$scientific_name)
df$scientific_name <- gsub("chittonae", "chiltonae", df$scientific_name)
df$scientific_name <- gsub("chillonae", "chiltonae", df$scientific_name)
df$scientific_name <- gsub("Thysanophys", "Thysanophrys", df$scientific_name)
df$scientific_name <- gsub("lepsurus", "lepturus", df$scientific_name)
df$scientific_name <- gsub("duaucelii", "duvauceli", df$scientific_name)
df$scientific_name <- gsub("duraucelii", "duvauceli", df$scientific_name)
df$scientific_name <- gsub("duvaucelii", "duvauceli", df$scientific_name)
df$scientific_name <- gsub("nigricaudus", "nigricauda", df$scientific_name)
df$scientific_name <- gsub("Ancanthurus", "Acanthurus", df$scientific_name)
df$scientific_name <- gsub("Elinephelus", "Epinephelus", df$scientific_name)
df$scientific_name <- gsub("Etinephelus", "Epinephelus", df$scientific_name)
df$scientific_name <- gsub("Gomphesus", "Gomphosus", df$scientific_name)
df$scientific_name <- gsub("Laptoscarus", "Leptoscarus", df$scientific_name)
df$scientific_name <- gsub("lebulous", "nebulosus", df$scientific_name)
df$scientific_name <- gsub("varigatus", "variegatus", df$scientific_name)
df$scientific_name <- gsub("veriegatus", "variegatus", df$scientific_name)
df$scientific_name <- gsub("flulviflamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("fluviflamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("bernati", "berndti", df$scientific_name)
df$scientific_name <- gsub("Ovaculichthys", "Novaculichthys", df$scientific_name)
df$scientific_name <- gsub("berbarinus", "barberinus", df$scientific_name)
df$scientific_name <- gsub("semcirculotus", "semicirculatus", df$scientific_name)
df$scientific_name <- gsub("Scolopis", "Scolopsis", df$scientific_name)
df$scientific_name <- gsub("Siggg", "Siganus", df$scientific_name)
df$scientific_name <- gsub("Sinagus", "Siganus", df$scientific_name)
df$scientific_name <- gsub("sandwichlensis", "sandwichiensis", df$scientific_name)
df$scientific_name <- gsub("lacheri", "lachneri", df$scientific_name)
df$scientific_name <- gsub("Leptoscurus", "Leptoscarus", df$scientific_name)
df$scientific_name <- gsub("haak", "harak", df$scientific_name)
df$scientific_name <- gsub("Lethritus", "Lethrinus", df$scientific_name)
df$scientific_name <- gsub("Luthrinus", "Lethrinus", df$scientific_name)
df$scientific_name <- gsub("fulfuiflamma", "fulviflamma", df$scientific_name)
df$scientific_name <- gsub("orgentimoeulatus", "argentimaculatus", df$scientific_name)
df$scientific_name <- gsub("argentues", "argenteus", df$scientific_name)
df$scientific_name <- gsub("orgentues", "argenteus", df$scientific_name)
df$scientific_name <- gsub("Parapenes", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parapenius", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("Parupeneus", "Parupeneus", df$scientific_name)
df$scientific_name <- gsub("barberins", "barberinus", df$scientific_name)
df$scientific_name <- gsub("berberinus", "barberinus", df$scientific_name)
df$scientific_name <- gsub("Platorhinchus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectorhichus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Plectohinchus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Pleitorhinchus", "Plectorhinchus", df$scientific_name)
df$scientific_name <- gsub("Platybalone", "Platybelone", df$scientific_name)
df$scientific_name <- gsub("Pomacanthurus", "Pomacanthus", df$scientific_name)
df$scientific_name <- gsub("Pseudorhombuo", "Pseudorhombus", df$scientific_name)
df$scientific_name <- gsub("Scanus", "Scarus", df$scientific_name)
df$scientific_name <- gsub("globiseps", "globiceps", df$scientific_name)
df$scientific_name <- gsub("acutiplanis", "acutipinnis", df$scientific_name)
df$scientific_name <- gsub("Utoreuthis", "Uroteuthis", df$scientific_name)
df$scientific_name <- gsub("Scarus tricolo$", "Scarus tricolor", df$scientific_name)
df$scientific_name <- gsub("Parupeneous macronema$", "Parupeneus macronemus", df$scientific_name)
df$scientific_name <- gsub("Parupeneus macronema$", "Parupeneus macronemus", df$scientific_name)
df$scientific_name <- gsub("Scarus russelli$", "Scarus russelii", df$scientific_name)
df$scientific_name <- gsub("Acanthurus tennentii", "Acanthurus tennenti", df$scientific_name)
df$scientific_name <- gsub("Lethrinus conchliatus", "Lethrinus conchyliatus", df$scientific_name)
df$scientific_name <- gsub("Naso brachycention", "Naso brachycentron", df$scientific_name)

# correcting spellings in validation list 
validation_lists$scientific_name <- gsub("Gymonthorax", "Gymnothorax", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Pomatonus", "Pomatomus", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Scarus tricolo$", "Scarus tricolor", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Parupeneous macronema$", "Parupeneus macronemus", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Parupeneus macronema$", "Parupeneus macronemus", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Scarus russelli$", "Scarus russelii", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Acanthurus tennentii", "Acanthurus tennenti", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Lethrinus conchliatus", "Lethrinus conchyliatus", validation_lists$scientific_name)
validation_lists$scientific_name <- gsub("Naso brachycention", "Naso brachycentron", validation_lists$scientific_name)
```

Double checking our df against the valid names so we know what names are typos. 

```{r}
# making df of names that are in the catch_composition (df) but are not in the validation_lists
# these names are typos - fix with gsub functions above 
valid_names <- validation_lists %>% select(scientific_name)
catch_names <- df %>% select(scientific_name)

unvalidated_names <- setdiff(catch_names, valid_names) %>% 
  filter(!scientific_name == "NANA") %>% filter(!scientific_name == "Nana")

# prints list that appear in survey dataset but don't match the validation list we have 
unique(sort(unvalidated_names$scientific_name))

# checking to see how many times a particular fish appears in the dataset
filter(df, scientific_name == "Scylla serrata") %>%
  select(number_of_fish) %>% filter(!is.na(number_of_fish)) %>%
  mutate(count = n(),
         sum = sum(number_of_fish))
```

1.) In catch composition and in fishbase but not on validation list. **Suggested fix: address if these are reasonable to find in Ghana and if they are, keep these entries.**  

- Acanthopagrus berda   
- Acanthurus tennenti  
- Aethaloperca rogaa  
- Alepes djedaba  
- Amanses scopas   
- Auxis thazard    
- Caranx hippos    
- Cephalopholis spp.  
- Cyprichromis leptosoma  
- Epinephelus melanostigma  
- Epinephelus spilotoceps    
- Gompheus caeruleus  
- Gymnothorax flavimarginatus  
- Gymnothorax monochrous   
- Himantura gerrardi  
- Kyphosus bigibbus  
- Lethrinus conchliatus  
- Lujtanus argentimaculatus  
- Monotaxis grandoculis  
- Mugil cephalus   
- Mulloidichthys pfluegeri  
- Naso brachycentron  
- Naso thynnoides  
- Ostracion nasus  
- Panulirus homarus  
- Panulirus ornatus  
- Panulirus penicillatus   
- Panulirus versicolor  
- Paracanthurus hepatus  
- Planiliza alata  
- Platybelone platyura  
- Plectorhinchus plagiodesmus  
- Plectorhinchus playfairi  
- Plotosus canius    
- Pomacanthus maculosus  
- Pseudorhombus arsius  
- Sardinella melanura  
- Scarus vaigiensis  
- Scolopsis bimaculata  
- Scylla serrata (this is a mud crab..)  
- Sepia pharaonis  
- Siganus canaliculatus  
- Siganus fuscescens  
- Siganus guttatus  
- Sphyraena japonica  
- Taeniura meyeni  
- Terapon theraps  
- Thunnus albacares  
- Thysanophrys chiltonae  
- Uroteuthis duvauceli  


2.) In catch composition but not in validation list or on fishbase (not close to a name we have so unsure what it is supposed to be). **Suggested fix: if there is not a clear answer to what these are supposed to be, filter them out.** 

- Acanthurus duvauceli   
- Acanthurus harak  
- Carangoides flavimarginatus   
- Carangoides florimaginatus    
- Cirnhitus lentjan  
- Halichoeres hartulanus  
- Hipposcarus scarus  
- Leptoscarus triostegus  
- Lethrinus macronemus   
- Lethrinus sutor   
- Lethrinus vaigiensis     
- Lutjanus canius   
- Monodactylus argentimailatus   
- Panulirus merra
- Parapenes barberins  
- Parupeneus semicirculatus    
- Platycephalus crocodilas  
- Pono blue fish (probably meant to be a common name..)  
- Scarus carolinus  
- Scarus sutor  
- Sphyraena leiura  
- Tafi sutor  
- Uroteuthis cynea  
- Uroteuthis lineatus  


3.) In validation list but is not on fish base. **No fix needed here, just an FYI.**.   

- Acanthurus vaigiensis


#### Filtering out species that may be incorrect or unexpected in our target area.

*Plotosus canius* is a catfish. Austin wanted to ask Chris about this one but for now it's removed. 

```{r}
# list of species to filter out
filter_out_species <- c("Pono blue fish", "Acanthopagrus berda", "Acanthurus duvauceli", "Aethaloperca rogaa", "Alepes djedaba", "Amanses scopas",
                        "Baracuda", "Carangoides flavimarginatus", "Carangoides florimaginatus", "Cirnhitus lentjan", "Cyprichromis leptosoma",
                        "Gompheus caeruleus", "Halichoeres hartulanus", "Leptoscarus triostegus", "Lethrinus macronemus", "Lujtanus argentimaculatus",
                        "Lutjanus canius", "Mulloidichthys pfluegeri", "Naso thynnoides", "Ostracion nasus", "Panulirus merra", "Panulirus ornatus", 
                        "Panulirus versicolor", "Paracanthurus hepatus", "Parupeneus semicirculatus", "Platycephalus crocodilas", "Plectorhinchus plagiodesmus",
                        "Pomacanthus maculosus", "Scarus sutor", "Scarus vaigiensis", "Scolopsis bimaculata", "Scylla serrata", "Taeniura meyeni", "Uroteuthis cynea",
                        "Uroteuthis lineatus", "Sardinella melanura", "Plotosus canius")

filter_sppdf <- data.frame(filter_out_species) %>%
  rename(scientific_name = filter_out_species)

df <- df %>% 
  filter(!scientific_name %in% filter_sppdf$scientific_name)

# checking this was removed
unique(sort(df$scientific_name))
```

#### Changing incorrect scientific names

```{r}
df$scientific_name <- gsub("Scarus carolinus", "Calotomus carolinus", df$scientific_name)
df$scientific_name <- gsub("Hipposcarus scarus", "Hipposcarus longiceps", df$scientific_name)
df$scientific_name <- gsub("Lethrinus vaigiensis", "Kyphosus vaigiensis", df$scientific_name)
df$scientific_name <- gsub("Acanthurus harak", "Lethrinus harak", df$scientific_name)
df$scientific_name <- gsub("Monodactylus argentimailatus", "Monodactylus argenteus", df$scientific_name)
df$scientific_name <- gsub("Lethrinus sutor", "Siganus sutor", df$scientific_name)
df$scientific_name <- gsub("Tafi sutor", "Siganus sutor", df$scientific_name)
df$scientific_name <- gsub("Sphyraena leiura", "Sphyraena japonica", df$scientific_name)
```



### Length (cm)

This column is a character for because of the "<" and "-". 

1.) 3 observations (rows) have 2 length values and multiple fish. changed these values to NA for now. 

- "16-20   ,46-50"    
- "26-30,21- 25"   

2.) Many operations by CLAPERTON KAZUNGU include a length value of 4488 which is not realistic so I changed these to NA for now. 

3.) Some ranges weren't correct like "16-25" and only have <10 observations like that so I changed them to the nearest possible category. e.g. "16-25" to "16-20". "21-30" to "21-25". 


```{r}
unique(sort(df$length_cm))

# replace the write in verbiage with no characters
df$length_cm <- gsub(">50 write in: ", "", df$length_cm)
df$length_cm <- gsub(">50 write in:", "", df$length_cm)

# replacing values that don't make sense
df$length_cm <- gsub("269-30", "26-30", df$length_cm)
df$length_cm <- gsub("Ë‚10", "<10", df$length_cm)
df$length_cm <- gsub(">10", "<10", df$length_cm)

# correcting incorrect ranges
df$length_cm <- gsub("31-15", "31-35", df$length_cm)
df$length_cm <- gsub("10-15", "11-15", df$length_cm)
df$length_cm <- gsub("31-37", "31-35", df$length_cm)
df$length_cm <- gsub("31-36", "31-35", df$length_cm)
df$length_cm <- gsub("16-25", "16-20", df$length_cm)
df$length_cm <- gsub("21-30", "21-25", df$length_cm)
df$length_cm <- gsub("26-35", "26-30", df$length_cm)
df$length_cm <- gsub("31.-35", "31-35", df$length_cm)
df$length_cm <- gsub("36-34", "36-40", df$length_cm)
df$length_cm <- gsub("25-30", "26-30", df$length_cm)
df$length_cm <- gsub("45-50", "46-50", df$length_cm)
df$length_cm <- gsub("31-25", "31-35", df$length_cm)
df$length_cm <- gsub("1-15", "11-15", df$length_cm)
df$length_cm <- gsub("26-31", "26-30", df$length_cm)
df$length_cm <- gsub("26-20", "26-30", df$length_cm)
df$length_cm <- gsub("21-26", "21-25", df$length_cm)
df$length_cm <- gsub("21-24", "21-25", df$length_cm)
df$length_cm <- gsub("16-30", "16-20", df$length_cm)
df$length_cm <- gsub("110-15", "11-15", df$length_cm)
df$length_cm <- gsub("111-15", "11-15", df$length_cm)
df$length_cm <- gsub("11-16", "11-15", df$length_cm)
df$length_cm <- gsub("41-46", "41-45", df$length_cm)


# taking out double values 
df$length_cm <- gsub("21-25 26-30", NA, df$length_cm)
df$length_cm <- gsub("21-25 26-31", NA, df$length_cm)
df$length_cm <- gsub("21-25, 26-30", NA, df$length_cm)
df$length_cm <- gsub("^$", NA, df$length_cm)

# converting <10 to a range of 0-10 
df <- df %>% 
  mutate(length_cm = if_else(length_cm == "<10", "0-10", length_cm),
         length_cm = if_else(length_cm == "<11", "11-15", length_cm),
         length_cm = if_else(length_cm == "<12", "11-15", length_cm),
         length_cm = if_else(length_cm == "<13", "11-15", length_cm),
         length_cm = if_else(length_cm == "<14", "11-15", length_cm),
         length_cm = if_else(length_cm == "<15", "11-15", length_cm),
         length_cm = if_else(length_cm == "<16", "16-20", length_cm),
         length_cm = if_else(length_cm == "<17", "16-20", length_cm))

# converting numerical values to ranges 
df$length_calc <- ifelse(grepl("-",df$length_cm), NA, df$length_cm) # if there is a "-" in the observation, then replace with NA and if not, put that value
df$length_calc <- as.numeric(df$length_calc) # converting this to numeric so I can use the next mutate function to change these values to bins

df <- df %>%
 mutate(length_calc = case_when(
    length_calc >= 0 & length_calc <= 10.5 ~ "0-10",
    length_calc >= 10.5 & length_calc <= 15.4 ~ "11-15",
    length_calc >= 15.5 & length_calc <= 20.4 ~ "16-20",
    length_calc >= 20.5 & length_calc <= 25.4 ~ "21-25",
    length_calc >= 25.5 & length_calc <= 30.4 ~ "26-30",
    length_calc >= 30.5 & length_calc <= 35.4 ~ "31-35",
    length_calc >= 35.5 & length_calc <= 40.4 ~ "36-40",
    length_calc >= 40.5 & length_calc <= 45.4 ~ "41-45",
    length_calc >= 45.5 & length_calc <= 50.4 ~ "46-50",
    length_calc >= 50.5 & length_calc <= 60.4 ~ "51-60",
    length_calc >= 60.5 & length_calc <= 70.4 ~ "61-70",
    length_calc >= 70.5 & length_calc <= 80.4 ~ "71-80",
    length_calc >= 80.5 & length_calc <= 90.4 ~ "81-90",
    length_calc > 90.5 ~ ">90")) 

df <- df %>%
  mutate(length_corrected = if_else(is.na(length_calc), length_cm, length_calc))

# double checking that worked for the corrected column 
unique(sort(df$length_cm))
unique(sort(df$length_corrected))
```

Correct output for length_corrected: `">90"   "0-10"  "11-15" "16-20" "21-25" "26-30" "31-35" "36-40" "41-45" "46-50" "51-60" "60-70" "70-80" "80-90"`. 

### Comparing Lmax to median length caught

Decide if we need to take these out or not. 

```{r}
fishbase <- read_excel("data/fishbase.xlsx", sheet = "life history") %>% #read in excel file 
  select(scientific_name, Lm, Lm_se_min, Lm_se_max, Lmax)

length_check <- full_join(df, fishbase, by = "scientific_name") %>%
  select(Operation_date, fisher_id, scientific_name, Lmax, length_corrected) %>%
  mutate(median_length = case_when(
    length_corrected == "0-10" ~ 5,
    length_corrected == "11-15" ~ 13,
    length_corrected == "16-20" ~ 18,
    length_corrected == "21-25" ~ 23,
    length_corrected == "26-30" ~ 28,
    length_corrected == "31-35" ~ 33,
    length_corrected == "36-40" ~ 38,
    length_corrected == "41-45" ~ 43,
    length_corrected == "46-50" ~ 48,
    length_corrected == "51-60" ~ 55.5,
    length_corrected == "61-70" ~ 65.5,
    length_corrected == "71-80" ~ 75.5,
    length_corrected == "81-90" ~ 85.5,
    length_corrected == ">90" ~ 100)) %>% ### circle back to what value to use here
  mutate(length_check = if_else(median_length > Lmax, "over", "under")) %>%
  filter(length_check == "over") %>%
  group_by(length_corrected, scientific_name) %>% 
  mutate(count = n()) %>% select(-Operation_date, -fisher_id) %>% distinct(); length_check
```

#### Correcting those size bin lengths that are over Lmax 

```{r}
df$length_corrected[df$scientific_name == "Acanthurus dussumieri" & df$length_corrected == "51-60"] <- "46-50"
df$length_corrected[df$scientific_name == "Parupeneus macronemus" & df$length_corrected == "41-45"] <- "36-40"

df$length_corrected[df$scientific_name == "Acanthurus triostegus" & df$length_corrected == "36-40"] <- "21-25"
df$length_corrected[df$scientific_name == "Acanthurus triostegus" & df$length_corrected == "31-35"] <- "21-25"
df$length_corrected[df$scientific_name == "Acanthurus triostegus" & df$length_corrected == "26-30"] <- "21-25"

df$length_corrected[df$scientific_name == "Gerres oyena" & df$length_corrected == "36-40"] <- "26-30"
df$length_corrected[df$scientific_name == "Gerres oyena" & df$length_corrected == "31-35"] <- "26-30"

df$length_corrected[df$scientific_name == "Leptoscarus vaigiensis" & df$length_corrected == "36-40"] <- "31-35"
df$length_corrected[df$scientific_name == "Leptoscarus vaigiensis" & df$length_corrected == "41-45"] <- "31-35"
df$length_corrected[df$scientific_name == "Leptoscarus vaigiensis" & df$length_corrected == "51-60"] <- "31-35"

df$length_corrected[df$scientific_name == "Lutjanus fulviflamma" & df$length_corrected == "61-70"] <- "31-35"
df$length_corrected[df$scientific_name == "Lutjanus fulviflamma" & df$length_corrected == "51-60"] <- "31-35"
```


## <a name="gear"></a> **Gear type, and fish numbers/final destination**

### Gear type 

Double check that this list looks right. Left off at looking at this list and then 

```{r}
df$`gear type` <- toupper(df$`gear type`)

df$`gear type` <- gsub("MONOFILLAMENT", "MONOFILAMENT", df$`gear type`)
df$`gear type` <- gsub("MONOFILLAMNET", "MONOFILAMENT", df$`gear type`)
df$`gear type` <- gsub("UNMODIFIED TRAP", "UNMODIFIED", df$`gear type`)
df$`gear type` <- gsub("MODIFIED TRAP", "MODIFIED", df$`gear type`)
df$`gear type` <- gsub("SPEAR GUN", "SPEARGUN", df$`gear type`)
df$`gear type` <- gsub("SEINE NETS", "SEINE NET", df$`gear type`)

unique(sort(df$`gear type`))
```

### Number of fish 

Doube check this range is what is expected. 

```{r}
unique(sort(df$number_of_fish))

df %>% ggplot(., aes(y=number_of_fish)) + geom_boxplot() + theme_bw()

#### filtering out 6,000 and 30,0000 
df$number_of_fish <- ifelse(df$number_of_fish > 150, NA, df$number_of_fish)
hist(df$number_of_fish)

unique(sort(df$number_of_fish))

df %>% subset(trap_type == "MODIFIED" | trap_type == "UNMODIFIED") %>%
  filter(number_of_fish > 100)
## 103 is highest value for unmodified and modified traps so I am changing the above filter to 150
## large majority is under 50
```

### Destination of fish

```{r}
df$destination <- toupper(df$destination)

df$destination <- gsub("OTHER WRITE IN:", "", df$destination)
df$destination <- gsub(" LOCAL CONSUMER", "LOCAL CONSUMER", df$destination)
df$destination <- gsub("LOCAL CONSUMERS", "LOCAL CONSUMER", df$destination)
df$destination <- gsub(" MZUNGU", "MZUNGU", df$destination)

unique(sort(df$destination))
```

## <a name="notes"></a> **Final check: any notes from both datasets**


```{r}
## check for any notes that the data collectors left for analysis 
unique(df$fishing_operation_notes)
unique(df$catch_composition_notes)
```

## <a name="export"></a> **Exporting cleaned dataset**

```{r}
head(df)
nrow(df)

write_xlsx(df, "data/cleaned-Fishlandings-data- CC-JM-Clay-IW updated 04-09-2022.xlsx")
```


